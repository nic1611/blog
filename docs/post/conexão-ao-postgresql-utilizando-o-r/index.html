<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Conexão ao PostgreSQL utilizando o R | Q.G do Tux</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Instalação do Pacote: RPostgresO pacote RPostgres nos fornece uma interface simples para conectar à base de dados mantidas no PostgreSQL, utilizando o DBI. Ele é umpacote como outro qualquer e portanto, pode ser instalado com o seguinte comando:
install.packages(&quot;RPostgres&quot;)Ou ainda, ele pode ser instalado via interface gráfica do RStudio, utilizando a aba Packages e depois Install.Para maiores informações sobre este pacote, consulte sua documentação disponível aqui (https://rpostgres.">
    <meta name="generator" content="Hugo 0.82.0" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    

  
  
    <link rel="stylesheet" href="/blog/ananke/dist/main.css_5c99d70a7725bacd4c701e995b969fea.css" >
  




    
      

    

    
    
    <meta property="og:title" content="Conexão ao PostgreSQL utilizando o R" />
<meta property="og:description" content="Instalação do Pacote: RPostgresO pacote RPostgres nos fornece uma interface simples para conectar à base de dados mantidas no PostgreSQL, utilizando o DBI. Ele é umpacote como outro qualquer e portanto, pode ser instalado com o seguinte comando:
install.packages(&quot;RPostgres&quot;)Ou ainda, ele pode ser instalado via interface gráfica do RStudio, utilizando a aba Packages e depois Install.Para maiores informações sobre este pacote, consulte sua documentação disponível aqui (https://rpostgres." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://nic1611.github.io/blog/post/conex%C3%A3o-ao-postgresql-utilizando-o-r/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-05-03T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2021-05-03T00:00:00&#43;00:00" /><meta property="og:site_name" content="Q.G do Tux" />

<meta itemprop="name" content="Conexão ao PostgreSQL utilizando o R">
<meta itemprop="description" content="Instalação do Pacote: RPostgresO pacote RPostgres nos fornece uma interface simples para conectar à base de dados mantidas no PostgreSQL, utilizando o DBI. Ele é umpacote como outro qualquer e portanto, pode ser instalado com o seguinte comando:
install.packages(&quot;RPostgres&quot;)Ou ainda, ele pode ser instalado via interface gráfica do RStudio, utilizando a aba Packages e depois Install.Para maiores informações sobre este pacote, consulte sua documentação disponível aqui (https://rpostgres."><meta itemprop="datePublished" content="2021-05-03T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2021-05-03T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="2044">
<meta itemprop="keywords" content="R,postgreSQL," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Conexão ao PostgreSQL utilizando o R"/>
<meta name="twitter:description" content="Instalação do Pacote: RPostgresO pacote RPostgres nos fornece uma interface simples para conectar à base de dados mantidas no PostgreSQL, utilizando o DBI. Ele é umpacote como outro qualquer e portanto, pode ser instalado com o seguinte comando:
install.packages(&quot;RPostgres&quot;)Ou ainda, ele pode ser instalado via interface gráfica do RStudio, utilizando a aba Packages e depois Install.Para maiores informações sobre este pacote, consulte sua documentação disponível aqui (https://rpostgres."/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  
  
  <header class="cover bg-top" style="background-image: url('https://images.unsplash.com/photo-1489875347897-49f64b51c1f8?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=1050&amp;q=80');">
    <div class="pb3-m pb6-l bg-black-60">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/blog/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Q.G do Tux
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/blog/post/" title="Artigos page">
              Artigos
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/blog/tags/" title="Tags page">
              Tags
            </a>
          </li>
          
        </ul>
      
      















    </div>
  </div>
</nav>

      <div class="tc-l pv6 ph3 ph4-ns">
        
          <h1 class="f2 f1-l fw2 white-90 mb0 lh-title">Conexão ao PostgreSQL utilizando o R</h1>
          
        
      </div>
    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        ARTIGOS
      </aside>
      




  <div id="sharing" class="mt3">

    
    <a href="https://www.facebook.com/sharer.php?u=https://nic1611.github.io/blog/post/conex%C3%A3o-ao-postgresql-utilizando-o-r/" class="facebook no-underline" aria-label="share on Facebook">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765,50.32h6.744V33.998h4.499l0.596-5.624h-5.095  l0.007-2.816c0-1.466,0.14-2.253,2.244-2.253h2.812V17.68h-4.5c-5.405,0-7.307,2.729-7.307,7.317v3.377h-3.369v5.625h3.369V50.32z   M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>

    </a>

    
    
    <a href="https://twitter.com/share?url=https://nic1611.github.io/blog/post/conex%C3%A3o-ao-postgresql-utilizando-o-r/&amp;text=Conex%c3%a3o%20ao%20PostgreSQL%20utilizando%20o%20R" class="twitter no-underline" aria-label="share on Twitter">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

    </a>

    
    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://nic1611.github.io/blog/post/conex%C3%A3o-ao-postgresql-utilizando-o-r/&amp;title=Conex%c3%a3o%20ao%20PostgreSQL%20utilizando%20o%20R" class="linkedin no-underline" aria-label="share on LinkedIn">
      <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

    </a>
  </div>


      <h1 class="f1 athelas mt3 mb1">Conexão ao PostgreSQL utilizando o R</h1>
      
      
      <time class="f6 mv4 dib tracked" datetime="2021-05-03T00:00:00Z">May 3, 2021</time>

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l">


<div id="instalação-do-pacote-rpostgres" class="section level1">
<h1>Instalação do Pacote: RPostgres</h1>
<p>O pacote RPostgres nos fornece uma interface simples para conectar à base de dados mantidas no PostgreSQL, utilizando o DBI. Ele é umpacote como outro qualquer e portanto, pode ser instalado com o seguinte comando:</p>
<pre class="r"><code>install.packages(&quot;RPostgres&quot;)</code></pre>
<p>Ou ainda, ele pode ser instalado via interface gráfica do RStudio, utilizando a aba <strong>Packages</strong> e depois <strong>Install</strong>.
Para maiores informações sobre este pacote, consulte sua documentação disponível aqui (<a href="https://rpostgres.r-dbi.org/" class="uri">https://rpostgres.r-dbi.org/</a>).</p>
</div>
<div id="gerenciando-uma-conexão" class="section level1">
<h1>Gerenciando uma Conexão</h1>
<p>Para executar comandos SQL no PostgreSQL, o primeiro passo é abrir uma conexão com o um banco de dados desejado. A função paraisso é a dbConnect() e ela possui alguns parâmetros que são requeridos para efetuar a conexão ao PostgreSQL, a saber:</p>
<ul>
<li><strong>user</strong> - nome do usuário do PostgreSQL</li>
<li><strong>password</strong> - senha do usuáriohost - endereço IP do PostgreSQL</li>
<li><strong>port</strong> - número da porta de conexão (a porta padrão do PostgreSQL é a 5432)</li>
<li><strong>dbname</strong> - nome do banco de dados que a conexão será estabelecida</li>
</ul>
<p>A função dbConnect() irá retornar uma variável que contém todas as informações sobre sua conexão e ela será usada por todas asoutras funções do pacote RPostgres para que seja possível submeter consultas.</p>
<p>Para efetuar a conexão, usa-se a função dbDisconnect() passando como parâmetro a variável de conexão. Essa função deve serchamada somente após executar todos os comandos SQL de interesse. Caso você se disconecte da base de dados e tente submetercomandos SQL, ocorrerá um erro. Assim, sendo necessário estabelecer uma nova conexão.</p>
<p>Dessa forma (e seguindo os passos da seção de Introdução), podemos escrever o seguinte formato geral de programa em R queestabelece a conexão com o banco de dados usado na disciplina para executar diversos comandos SQL:</p>
<pre class="r"><code>library(RPostgres)
#aqui estamos definindo nossa conexão e atribuindo essa conexão à variável con
con &lt;- dbConnect(Postgres(),                
                user = &quot;postgres&quot;,                 
                password = &quot;123&quot;,                 
                host = &quot;localhost&quot;,                 
                port = 5432,                 
                dbname = &quot;departamento&quot;)
                
#visualizando alguns dados sobre a conexão estabelecida
con
## &lt;PqConnection&gt; departamento@localhost:5432#depois de estabelecida a conexão, podemos executar aqui vários comandos SQL sobre a nossa base de dados!
#assim que terminarmos de executar todos os comandos SQL que nos interessad, devemos fechar a conexão:
dbDisconnect(con)</code></pre>
</div>
<div id="nota-importante" class="section level1">
<h1>Nota Importante</h1>
<p>É importante enfatizar que no programa R anteriormente mostrado (e os que serão apresentados nesse material) utilizará uma formainsegura de estabelecer a conexão com um banco de dados no sentido de expor a senha de um usuário em um script. Este materialexpõe a senha somente para fins acadêmicos. Existem algumas formas de melhorar essa segurança em programas R:</p>
<ol style="list-style-type: decimal">
<li>Se sua aplicação executa no RStudio, você pode usar o comando rstudioapi::askForPassword(“Informe sua senha”)(atribua essa função ao parâmetro <strong>password</strong>) para que uma caixa de diálogo no RStudio abra e o usuário consiga informar asenha.</li>
<li>Manter a senha criptografada em um arquivo e fazer essa leitura pelo R, atribuindo o resultado no parâmetro (existe um pacotepara realizar tais criptografias: cyphr (<a href="https://www.rdocumentation.org/packages/cyphr/versions/1.1.0" class="uri">https://www.rdocumentation.org/packages/cyphr/versions/1.1.0</a>)).</li>
</ol>
<p>Tais tópicos fogem do escopo da disciplina, porém são dadas essas opções de soluções como forma de complementar o assunto.</p>
</div>
<div id="comandos-básicos-do-pacote-rpostgres" class="section level1">
<h1>Comandos básicos do Pacote RPostgres</h1>
<p>O pacote RPostgres possui diversas funções que podem nos ajudar a relembrar a estrutura de nosso banco de dados e até mesmorecuperar dados de forma mais fácil (sem precisar submeter comandos em SQL).</p>
<p>De uma forma prática, o código abaixo demonstra vários desses comandos:</p>
<pre class="r"><code>library(RPostgres)
con &lt;- dbConnect(Postgres(),                 
                  user = &quot;postgres&quot;,                 
                  password = &quot;123&quot;,                 
                  host = &quot;localhost&quot;,                 
                  port = 5432,                 
                  dbname = &quot;departamento&quot;)

#a função abaixo lista todas as tabelas do banco de dados conectado
dbListTables(con)
## [1] &quot;empregado&quot;         &quot;departamento&quot;      &quot;localizacao_depto&quot;
## [4] &quot;projeto&quot;           &quot;trabalha&quot;          &quot;dependente&quot;

#a função abaixo lista todas os atributos de uma tabela específica
dbListFields(con, &quot;empregado&quot;)
##  [1] &quot;primeironome&quot;   &quot;inicialmeio&quot;    &quot;ultimonome&quot;     &quot;numempregado&quot;  
##  [5] &quot;datanascimento&quot; &quot;endereco&quot;       &quot;sexo&quot;           &quot;salario&quot;       
##  [9] &quot;numsupervisor&quot;  &quot;numdepto&quot;

#a função abaixo retorna todos valores de uma tabela específica como um data.frame
dbReadTable(con, &quot;empregado&quot;)

dbDisconnect(con)</code></pre>
<p>Existe também a função dbWriteTable() que escreve um data.frame diretamente no banco de dados conectado. Assim, ela recebetrês parâmetros: a conexão, nome da tabela como string e o data.frame. Há também a função dbRemoveTable() que removeuma tabela do banco de dados (informando como parâmetro a conexão e o nome da tabela como string).</p>
</div>
<div id="execução-de-instruções-sql" class="section level1">
<h1>Execução de Instruções SQL</h1>
<p>A seguir, este material mostra como executar comandos que não recuperam dados (ou seja, comandos de inserção, alteração e remoção)bem como comandos que recuperam dados como data.frame (que podem ser convertidos como tibble).</p>
</div>
<div id="inserção-alteração-e-remoção" class="section level1">
<h1>Inserção, Alteração e Remoção</h1>
<p>Para executar um comando SQL que não recupera dados, usa-se a função dbExecute(). Essa função retorna o número de registros(tuplas) que foram afetadas pelo comando SQL executado (ou ainda, o valor do RETURNING - ver exemplo). Usualmente, essa função éusada para executar uma instrução SQL (que pode ser parametrizada).</p>
<p>A seguir, são apresentados alguns exemplos de execução de comandos de inserção (inclusive inserção em lote), alteração e remoção de dados:</p>
<pre class="r"><code>library(RPostgres)
con &lt;- dbConnect(Postgres(),                 
                  user = &quot;postgres&quot;,                 
                  password = &quot;123&quot;,                 
                  host = &quot;localhost&quot;,                 
                  port = 5432,                 
                  dbname = &quot;departamento&quot;)
                  
#verificando os dados atuais da tabela dependente
dbReadTable(con, &quot;dependente&quot;)</code></pre>
<pre class="r"><code>#inserindo um novo filho para o empregado com código 3
dbExecute(con, &quot;INSERT INTO dependente(numempregado, nomedependente, sexo, dataaniversario, parentesco) VALUES           (3, &#39;Julio&#39;, &#39;M&#39;, &#39;2020-05-10&#39;, &#39;filho&#39;)&quot;)
## [1] 1

#Lembre-se que vários registros podem ser inseridos com uma mesma instrução INSERT INTO (separando os parênteses depois do VALUES usando vírgula). Por exemplo, inserindo 2 filhos para o empregado 4
dbExecute(con, &quot;INSERT INTO dependente(numempregado, nomedependente, sexo, dataaniversario, parentesco) VALUES           (4, &#39;Kevin&#39;, &#39;M&#39;, &#39;2019-06-10&#39;, &#39;filho&#39;),          
          (4, &#39;Kate&#39;, &#39;F&#39;, &#39;2019-06-10&#39;, &#39;filho&#39;)&quot;)
## [1] 2

#Ainda, podemos realizar inserção em lote usando listas da linguagem R. 
#Por exemplo, seja a seguinte lista de valores a serem inseridos como dependentes do empregado 6 e 3. Se fossémos fazer do jeito tradicional, precisaríamos de 2 instruções INSERT INTO. Entretanto, vamos fazer por meio de parametrização.
#Primeiro, definimos uma lista, que deve possuir o mesmo número de colunas da tabela dependente, seguindo a mesma ordem das colunas a serem definidas na parte do INSERT INTO e cada elemento dessa lista é prirmeiro um vetor com mesmo número de valores
deps &lt;- list(c(6, 6, 3, 3),                
              c(&quot;André&quot;, &quot;Marca&quot;, &quot;Fabiacino&quot;, &quot;Andrea&quot;),               
              c(&quot;M&quot;, &quot;F&quot;, &quot;M&quot;, &quot;F&quot;),                
              c(&quot;2019-05-02&quot;, &quot;2017-06-03&quot;, &quot;2018-07-10&quot;, &quot;2018-07-10&quot;),                
              c(&quot;conjuge&quot;, &quot;filho&quot;, &quot;filho&quot;, &quot;filho&quot;))

#perceba o formato da lista criada (que reflete a estrutura da tabela em que seus valores serão inseridos em lote):
deps
## [[1]]
## [1] 6 6 3 3
## 
## [[2]]
## [1] &quot;André&quot;     &quot;Marca&quot;     &quot;Fabiacino&quot; &quot;Andrea&quot;   
## 
## [[3]]
## [1] &quot;M&quot; &quot;F&quot; &quot;M&quot; &quot;F&quot;
## 
## [[4]]
## [1] &quot;2019-05-02&quot; &quot;2017-06-03&quot; &quot;2018-07-10&quot; &quot;2018-07-10&quot;
## 
## [[5]]
## [1] &quot;conjuge&quot; &quot;filho&quot;   &quot;filho&quot;   &quot;filho&quot;

#inserção em lote (os $x, onde x vai de 1 até 5, serão trocados por cada valor correspondente da lista definida)
dbExecute(con, &quot;INSERT INTO dependente(numempregado, nomedependente, sexo, dataaniversario, parentesco) VALUES ($1, $2, $3, $4, $5)&quot;, params = deps)
## [1] 4
#checando as inserçõesdbReadTable(con, &quot;dependente&quot;)</code></pre>
<pre class="r"><code>#vamos excluir os dependentes do funcionário chamada Ana Silva
dbExecute(con, &quot;DELETE FROM dependente WHERE numempregado IN (SELECT numempregado FROM empregado WHERE primeironome = &#39;Ana&#39; AND ultimonome = &#39;Silva&#39;)&quot;)
## [1] 3

#vamos alterar o sexo do dependente chamado Vicente do numempregado 4
dbExecute(con, &quot;UPDATE dependente SET sexo = &#39;M&#39; WHERE numempregado = 4 AND nomedependente = &#39;Vicente&#39;&quot;)
## [1] 1

#checando as remoções e alteração
dbReadTable(con, &quot;dependente&quot;)</code></pre>
<pre class="r"><code>dbDisconnect(con)</code></pre>
<p><strong>IMPORTANTE: Se você executar o trecho de código acima mais de uma vez, você encontrará um erro nas inserções. Isso se deve aofato de que você estará tentando incluir dados repetidos em colunas que são únicas (chaves primárias). Então, cuidado.</strong></p>
<p>Por debaixo dos panos, a função dbExecute() realiza as seguintes tratativas: (i) envia o comando SQL ao PostgreSQL, (ii) captura onúmero de linhas afetadas pelo comando, e (iii) libera o resultado em memória (deixando apenas a cópia para o R). Isso poupa otrabalho de chamar três funções de forma consecutiva ao RPostgres (ou seja, dbSendStatement(), dbGetRowsAffected() edbClearResult()). Então, recomenda-se, para fins comuns, a utilização da função dbExecute() para execução de comandosvariados que não resultam na recuperação de dados.</p>
<div id="nota-importante-1" class="section level3">
<h3>Nota Importante</h3>
<p>O uso de parâmetrização (ou seja, $x no comando SQL e então a especificação do valor como parâmetro usando o params) é umaprática para evitar SQL Injection (<a href="https://pt.wikipedia.org/wiki/Inje%C3%A7%C3%A3o_de_SQL" class="uri">https://pt.wikipedia.org/wiki/Inje%C3%A7%C3%A3o_de_SQL</a>). Esse tipo de tópico vai também além doescopo da disciplina, porém é importante saber sobre seu risco e como evitar. Para a disciplina, não é necessário usar comandosparametrizados.</p>
</div>
</div>
<div id="execução-de-comandos-que-retorna-dados" class="section level1">
<h1>Execução de Comandos que Retorna Dados</h1>
<p>Várias instruções SQL podem recuperar dados de um banco de dados. Dessa forma, devemos usar a função dbGetQuery(), a qualretorna um data.frame. A execução de consultas SQL é o clássico exemplo de recuperação de dados de um banco de dados.Entretanto, outros comandos podem recuperar dados, tal como a instrução INSERT INTO como será visto em seguida.</p>
</div>
<div id="consultas" class="section level1">
<h1>Consultas</h1>
<p>A seguir, são apresentados alguns exemplos de execução de consultas SQL (SELECT). O data.frame resultante pode ser convertidopara um tibble que pode ser usado por outros pacotes do R (como tidyverse) visando sua manipulação e visualização.</p>
<pre class="r"><code>library(RPostgres)
library(tidyverse) 
#pois iremos usar tibble

on &lt;-dbConnect(Postgres(),                 
                user = &quot;postgres&quot;,                 
                password = &quot;123&quot;,                 
                host = &quot;localhost&quot;,                 
                port = 5432,                 
                dbname = &quot;departamento&quot;)
                
#executando a seguinte consulta:
# Recupere todos os departamentos e suas localizações#a função as_tibble converte o resultado da função dbGetQuery para um tibble

projetos &lt;- as_tibble(dbGetQuery(con, &quot;SELECT nomedepto, localizacao                        
                                        FROM departamento d, localizacao_depto l                       
                                        WHERE d.numdepto = l.numdepto&quot;))

projetos</code></pre>
<pre class="r"><code>#executando a seguinte consulta:
# Retorne o nome do departamento, a média salárial, bem como o salário mínimo e máximo, de todos osempregados que trabalham em um departamento com mais de 3 empregados, agrupando por departamento. Ordene, em ordem descendente, pela média:

media_salarial &lt;- as_tibble(dbGetQuery(con,&quot;SELECT nomedepto, AVG(salario) media, MIN(salario) min, MAX(salario) maxFROM empregado e, departamento dWHERE e.numdepto = d.numdeptoGROUP BY nomedeptoHAVING COUNT(nomedepto) &gt; 3ORDER BY media desc&quot;))

media_salarial

dbDisconnect(con)</code></pre>
<p><strong>IMPORTANTE: Se você modificou sua base de dados, os resultados aqui poderão ser diferentes.</strong></p>
<p>Por debaixo dos panos, a função dbGetQuery() realiza as seguintes tratativas: (i) envia o comando SQL ao PostgreSQL, (ii) captura oresultado para uma variável, e (iii) libera o resultado em memória (deixando apenas a cópia para o R). Isso poupa o trabalho de chamartrês funções de forma consecutiva ao RPostgres (ou seja, dbSendQuery(), dbFetch() e dbClearResult()). Então, recomenda-se,para fins comuns, a utilização da função dbGetQuery() para execução de comandos variados que resultam na recuperação de dados.</p>
</div>
<div id="recuperação-de-dados-a-partir-de-inserção" class="section level1">
<h1>Recuperação de Dados a partir de Inserção</h1>
<p>A seguir, veremos que o comando INSERT INTO pode também recuperar dados. Isso ocorre quando temos uma coluna que usasequência para definir seus valores, tal como quando definimos a chave primária de uma tabela usando o tipo SERIAL. Vimos quepodemos usar funções do PostgreSQL para capturar valores da sequência.</p>
<p>Aqui iremos ver como capturar o valor gerado por uma coluna que usou o tipo SERIAL em sua definição (que no fundo é umasequência) logo após UMA inserção. Isso é útil para inserção de um registro em uma tabela e a utilização de seu identificador único parainserir um segundo registro.</p>
<p>Isso é mostrado no exemplo abaixo:</p>
<pre class="r"><code>library(RPostgres)

con &lt;- dbConnect(Postgres(),                 
                  user = &quot;postgres&quot;,                 
                  password = &quot;123&quot;,                 
                  host = &quot;localhost&quot;,                 
                  port = 5432,                 
                  dbname = &quot;departamento&quot;)
                  
#verificando os dados atuais da tabela departamento
dbReadTable(con, &quot;departamento&quot;)</code></pre>
<pre class="r"><code>#verificando os dados atuais da tabela localizacao_Depto
dbReadTable(con, &quot;localizacao_depto&quot;)</code></pre>
<pre class="r"><code>#inserindo um departamento e retornando o numdepto gerado pela sequência usada (lembre-se que o numdepto foi definido como SERIAL; com isso, uma sequência é associada a coluna numdepto, gerando números sequenciais. Podemos capturar o valor gerado para essa inserção usando o RETURNING no final do comando INSERT INTO.)

id &lt;- dbGetQuery(con, &quot;INSERT INTO departamento(nomedepto, numgerente) VALUES (&#39;TI&#39;, 2) RETURNING numdepto&quot;)
id 

#repare que ele é um data.frame e podemos capturar seu valor (único) por meio do operador $

#agora vamos inserir a localização desse departamento inserido. Repare no uso da parametrização para associar um valor. Poderíamos também montar a string com o comando, por exemplo, usando a função de concatenação paste0()
dbExecute(con, &quot;INSERT INTO localizacao_depto(numdepto, localizacao) VALUES ($1, &#39;DV&#39;)&quot;, params = id$numdepto)
## [1] 1

#verificando os dados após a inserção
dbReadTable(con, &quot;departamento&quot;)

#verificando os dados após a inserção
dbReadTable(con, &quot;localizacao_depto&quot;)

dbDisconnect(con)</code></pre>
</div>
<div id="conclusão" class="section level1">
<h1>Conclusão</h1>
<p>Este material integra os conceitos do projeto físico de banco de dados em uma aplicação implementada em R. Em geral, os conceitosvistos aqui se aplicam à outras linguagens de programação, porém, claro, mudando a sintaxe e nome de funções.</p>
<p>Uma dica geral é deixar o Sistema Gerenciador de Banco de Dados fazer todo o trabalho “sujo” e somente tratar e visualizar os dados nolado da aplicação.</p>
</div>
<ul class="pa0">
  
   <li class="list">
     <a href="/blog/tags/r" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">R</a>
   </li>
  
   <li class="list">
     <a href="/blog/tags/postgresql" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">postgreSQL</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Relacionado</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/blog/post/introducao-visualizacao/">Introdução a visualização de dados</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://nic1611.github.io/blog/" >
    &copy;  Q.G do Tux 2021 
  </a>
    <div>














</div>
  </div>
</footer>

  </body>
</html>
